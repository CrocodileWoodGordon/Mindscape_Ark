# Progress Log

## Completed
- Recreated a clean project scaffold with `src/core`, `systems`, `maps`, `assets`, and a smoke test harness.
- Implemented the start menu with layered title rendering, bundled font resolution, and bilingual presentation.
- Added the glitch boot, mosaic reveal, and guided cutscene that tutorials movement, combat, auto-pathing, interaction, reload, and input-method reminders.
- Built the Dormitory (Floor 50) loop: regenerated collision from `Floor50_mask.png`, staged quests, frame-triggered combat, terminal log gating, and elevator unlock toward Floor 40.
- Finished player navigation: WASD movement with conflict locks, right-click A* pathfinding with nearest-cell fallback, click feedback, and centered minimap tracking.
- Delivered the combat system: bullet spawning, cooldown/reload, HP HUD, enemy spawn heuristics, chase AI, aggro boundaries, melee attacks, telegraphed FX, death fades, and enemy health bars.
- Added the interaction layer: F prompts, dialog overlay with timer, terminal/frame messaging, NPC state handling, and elevator locks bound to quest stages.
- Developed the Sensory Lab (Floor 40): abstract collision rendering, trap cycles, energy barriers, fight/bypass branching logic, NPC state machine, branch-tailored enemy spawns, quest progression, and switch-controlled elevator unlock.
- Polished UI/feedback: quest HUD, minimap, health/ammo/reload display, player hit flash, and debug coordinate readout.
- Hardened the resource pipeline: NotoSansSC font preference, optional `boot_glitch.wav`, walk-cycle animation, and map loader improvements.
- Constructed the Memory Archive (Floor 35): maze collision + map image, ambient anomaly spawns, multi-phase boss encounter, flashback sequence, and elevator/log gating into Floor 30.
- Engineered the Logic Core (Floor 30): relay-sequencing puzzle, UI glitch vignette, failure feedback damage, weapon cache reward, ethics log gating, and elevator unlock toward Floor 25.
- Implemented an ESC-driven pause menu overlay with selectable options, plus exit-to-desktop and return-to-title wiring.
- Adjusted the pause menu confirm modal layout to prevent overlap between the unsaved warning text and option buttons.
- Added close (X) buttons to the pause menu and the unsaved-confirm modal.
- Completed the achievements system with story-based milestones, unlock hooks, and an achievements screen showing completion counts.
- Added a small achievement unlock toast during gameplay.
- Regenerated Floor 35 collision grid from Floor35_mask.png and added spawn clamping to keep archive boss/minions in walkable cells.
- Adjusted the Floor 35 player spawn point to avoid spawning inside walls when arriving from Floor 40.
- Moved the Floor 35 spawn point up by 30px to prevent getting stuck after teleport.
- Updated Floor 35 exit interaction zone and replaced terminal gating with an automatic audio dialog + elevator unlock after the boss sequence.
- Moved the Floor 35 terminal interaction region to the new coordinates.
- Restored Floor 35 terminal availability after the boss audio sequence so the prompt appears again.
- Regenerated Floor 25 collision grid from Floor25_mask.png and adjusted the spawn to keep 50px wall clearance.
- Updated the Floor 25 spawn position per latest coordinates request.
- Expanded achievements list and added a scrollable achievements panel with draggable scrollbar and mouse wheel support.
- Clipped the achievements list rendering so rows no longer overflow the panel.
- Added a load menu listing all saves with timestamps for selection when loading.
- Stored save timestamps and surfaced them in the load list so players can choose by time.
- Renamed Floor 35 image assets to Floor35.png and Floor35_2.png with code/map references updated.
- Rebuilt Floor 30 map (640x1280) collision from Floor30_mask.png, refreshed interaction zones from Floor30_logic.png, and rewired the server toggle puzzle with terminal/elevator/shotgun unlock flow.
- Added per-floor map scaling so Floor 30 renders at one-third the normal zoom.
- Updated weapon slot order and clip sizes (sidearm 7, scattergun 5, rifle 25).
- Ensured Floor 35 elevator unlocks when the audio terminal is read.
- Adjusted Floor 35 boss aftermath so the audio auto-plays, elevator unlocks immediately, and the quest/terminal availability update after the audio finishes.
- 编写了用于生成 Floor 15（身份棱镜）地图的像素风提示词，匹配项目画风与剧情定位。
- 细化了 Floor 15（身份棱镜）地图的生成提示词，使其更贴合整体画风与剧情主题。

- 完成第7层避难所(F10)内容：新增Floor10地图JSON(由mask生成)、从F25直达F10、艾拉交互/溶解动画与防御战(5波净化者+艾拉手枪支援)、非暂停式战斗对白、分支后电梯权限解锁及相关任务提示与成就。
- 调整F10地图缩放为当前全局缩放的一半。
- 更新第7层避难所(F10)流程：进入层后指引者下达使用认知溶解剂指令，任务先寻找艾拉，靠近触发暂停式对话并在结束时启动五波怪，后续交互改为使用认知溶解剂并维持两分支剧情。
- 调整F10防御战每波怪物出生点为指定的五个坐标。
- 优化A*寻路：为固定碰撞楼层预处理可通行与连通区缓存，并在F10怪物中启用全图追杀+A*追击逻辑。
- 重做第2层(F40)：依据新1024x1024地图/遮罩重建碰撞网格与出生点，更新交互区域与分支路线陷阱/阻隔逻辑，适配新坐标。
- 更新第2层(F40)流程：新增摔倒NPC占位图与坐标，任务改为“与？？？对话→清理异常→解锁中央电梯”，移除路径消失/改道逻辑，并预处理F40 A*分界点路径缓存。
- 删除成就“感官抉择”和“感官裂隙”及其触发点。
- 完成第15层镜像空间：实现轴线锁定与解锁、镜像同步战斗、对话获取认知溶解剂、触发镜像Boss战（A*追击/射击与慢速换弹）、碎裂特效及步枪掉落，并补充占位素材。
- 完成Floor0剧情分支：按镜像Boss触发/注射溶解剂两布尔值切换觉醒度文本，补充助手研究员出场与觉醒度结论展示，并锁定本层操作逻辑。
- 调整第2层(F40)倒地NPC渲染：载入后旋转90度以匹配躺倒姿态。
- 修复第1层引导卡在“等待系统初始化”：启动引导对白时设置完成回调，结束后切换至探索阶段。
- 更新楼层跳转链：F25->F15、F15->F10、F10->F0，并新增Floor0地图配置以支持最终剧情层加载。
- 修正第3层Boss脉冲判定：脉冲伤害仅在红圈内生效，圈外不再无掩护也受伤。
- 更新第15层镜像空间：新增进入层指引对白，并让敌人呈现中轴线镜像效果。
- 调整第15层镜像流程：改为先前往中轴线触发对话后生成四分区怪物，并更新任务提示与清怪流程。
- 修复第3层清怪后错误跳到“终端已重新开放”：在档案馆层清怪不再覆盖任务阶段。
- 重写资源路径基准：使用冻结/开发环境兼容的根目录解析，并在地图加载时传入基准路径，避免打包后资源丢失。
- 更新 README 面向玩家的说明与玩法简介，并在醒目位置提示从右侧 Releases 下载对应系统版本。
- 基于当前源代码重写 README，补齐已实现楼层/系统/存档成就与操作说明。
- 重做成就列表以匹配现有楼层与剧情，并新增终章结算成就与镜像相关成就。
- 在终章结束后加入结算菜单，可直接查看成就或返回标题，并调整相关输入逻辑。
- 新增“无伤通关”成就，并在通关时检测是否全程未受伤。
- 新增根目录入口 main.py 并调整构建工作流入口，避免打包后入口脚本无法正确解析包结构。
- 修复 src/main.py 在脚本方式执行时的导入路径，避免 PyInstaller 以脚本执行入口时触发相对导入异常。
- 拆分打包根目录与资源目录：冻结环境下优先使用 sys._MEIPASS 定位 assets，避免 onedir 的 _internal 目录导致资源丢失。
- 修正打包环境地图图片路径解析：地图加载改用资源根目录的父级作为基准，确保 image 字段能解析到 _internal/assets。
- 修复镜像层对话触发判定：只有靠近镜像实体范围内才会出现对话交互提示。
## In Progress
- Pause menu options for save/achievements are stubbed and awaiting full implementations.
- Save system hooks are reserved via `data/saves` but persistence is not wired up.

## Next Up
- Outline the Pathos Resonator (Floor 25) emotional trials and encounter flow.
- Extend the combat sandbox with additional weapons, achievements, and enemy archetypes.
- Broaden audio/visual polish and run performance profiling before scaling to deeper floors.
