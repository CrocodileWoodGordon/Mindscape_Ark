# MindscapeArk心景方舟 - 最终敲定版项目开发大纲
## 核心基础信息     
| 项⽬                | 具体规则                                                                 |
|---------------------|--------------------------------------------------------------------------|
| 项目定位            | 2D像素风地牢探索+即时射击战斗+轻量存档的单机游戏                         |
| 技术栈              | Python 3.9+、Pygame 2.5+（像素风游戏适配性优先）                         |
| 美术基础单位        | 1地图格子=64×64像素，整体适配1280×720游戏窗口                           |
| 版本命名规则        | Alpha阶段版本号为v0.x（x为功能模块完成数/迭代次数）                      |
| Git分支规则         | 分支名包含功能模块（如`feature/map-collision`），合并至develop需通过单元测试 |

## 1. 地图模块（核心规则）
### 1.1 碰撞层与地图格式
- 碰撞层：JSON格式二维数组，值定义如下：`0=可通行、1=墙壁、2=可交互区域、3=电梯区域、4=BOSS战触发区域`
- 不可到达区域：基于对应楼层地图PNG文件拓展设计，背景风格匹配当前楼层像素环境（如金属纹理/数据噪点）
- 地图存储：JSON碰撞层文件与PNG视觉地图文件一一对应，路径统一为`assets/maps/[楼层名]/`

### 1.2 地图渲染规则
- 渲染比例：64×64像素/格子，可根据窗口自适应缩放（保持像素比例不变）
- 不可到达区域：作为地图PNG的分层图层渲染，与可通行区域视觉区分

## 2. 移动与寻路模块
### 2.1 移动触发逻辑
- 长按判定：长按鼠标左键0.2秒触发直线移动，时长为固定标准
- 阻挡处理：长按移动遇墙壁/障碍物时，**仅该方向速度分量置0**（非阻挡方向可继续移动）
- 寻路中断：目标点被突然阻挡时，**自动重新计算路径**（无玩家提示，静默执行）

### 2.2 寻路视觉与逻辑
- 路径显示：取消所有寻路路径的视觉展示，仅保留底层寻路逻辑
- 寻路算法：采用A*算法，聚焦路径计算效率（适配多障碍物场景）

### 2.3 寻路精度
- 寻路精度不是方格，而是要在性能允许的前提下尽量小，尽量平滑移动。

## 3. 战斗系统模块
### 3.1 武器与弹药规则
- 弹药体系：不同武器独立弹药，无共享总弹量，仅关注弹夹内弹量
- 弹药显示：生命值下方展示「子弹图标 + 数字/数字」（当前弹量/弹夹总容量）
- 弹药回复：仅通过自定义按键（暂定为R键）触发回复，无拾取/场景自动回复
- 攻击逻辑：右键点击敌人超出攻击范围时，角色自动寻路至攻击范围，到达后**自动停止移动并触发攻击**（无需二次点击）

### 3.2 敌人行为与属性
- 基础属性：敌人血量、攻击间隔、移动速度、仇恨范围均为**可调整变量**（代码中预留接口，无初始固定值）
- BOSS机制：代码中预留阶段切换接口，触发条件（如血量阈值）为可配置变量
- 仇恨逻辑：仇恨范围为变量，玩家进入范围内敌人主动追击（无固定数值）

## 4. UI与交互模块
### 4.1 小地图规则
- 位置与尺寸：左上角，150×150像素，仅显示「碰撞地图（可通行区域多边形）+ 居中的玩家图标」
- 显示范围：当前楼层可通行区域全图，无敌人/NPC/可交互物件标记

### 4.2 对话框与文字
- 对话框样式：统一为「像素边框 + 半透明填充」，顶部增加「说话者标签」（系统/角色名/文本），无类型区分
- 打字机效果：玩家点击「继续」时，**立即显示整段文字**（无逐行/逐字中断）

### 4.3 右上角UI
- 排版：「当前楼层」在上，「任务提示」在下，文本超过显示长度时**自动换行**（无滚动/截断）
- 样式：像素风文字，字体大小适配64×64基础单位（暂定为24号像素字体）

## 5. 存档与数据管理模块
### 5.1 存档基础规则
- 格式与路径：JSON格式，默认存储路径为项目根目录`data/saves/save.json`，**自动覆盖最新存档**（仅单存档位）
- 存档粒度：
  - 敌人数据：仅记录已击败敌人的「类型字符串」（如“数据畸变体”）
  - 对话数据：保存对话分支的「节点ID（整数唯一标识）」

## 6. 资源与测试模块
### 6.1 占位资源
- 命名规则：待prompt生成后，由AI统一生成`assets/`目录下的资源命名规范（分`images/`、`audio/`子目录）
- 资源类型：简单像素图（角色/武器占位）、空白音频（音效占位）

### 6.2 单元测试规则
- 测试覆盖：每个功能模块需覆盖「核心目标验证」，如：
  - 寻路模块：不同地图复杂度下A*寻路准确性、阻挡后重新寻路效率
  - 战斗模块：武器攻击范围判定、自动寻路攻击触发逻辑
  - 碰撞模块：角色与墙壁/特殊区域碰撞判定准确性
